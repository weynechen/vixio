================================================================================
                      Xiaozhi 并发集成测试 - 使用说明
================================================================================

前提条件：
----------
1. 确保 Vixio 服务器正在运行（默认 ws://localhost:8000/xiaozhi/v1/）
2. 测试音频文件：tests/test.wav (已存在，462KB)

快速开始：
----------

# 1. 进入 vixio 目录
cd /home/ubuntu/project/toothbrush/toothbrush_chat/xiaozhi-esp32-server/main/vixio

# 2. 运行基础测试（5个并发客户端）
uv run python tests/test_concurrent_xiaozhi.py

# 3. 或使用脚本运行
./run_concurrent_test.sh

常用命令：
----------

# 指定并发数（例如：10个客户端）
uv run python tests/test_concurrent_xiaozhi.py --clients 10

# 高并发压力测试（50个客户端）
uv run python tests/test_concurrent_xiaozhi.py --clients 50

# 测试打断功能（30%打断概率）
uv run python tests/test_concurrent_xiaozhi.py --clients 5 --interrupt-prob 0.3

# 测试断开重连（15%断开概率）
uv run python tests/test_concurrent_xiaozhi.py --clients 5 --disconnect-prob 0.15

# 调试模式（详细日志）
uv run python tests/test_concurrent_xiaozhi.py --clients 1 --log-level DEBUG

# 完整参数示例
uv run python tests/test_concurrent_xiaozhi.py \
  --clients 20 \
  --url ws://localhost:8000/xiaozhi/v1/ \
  --audio tests/test.wav \
  --interrupt-prob 0.2 \
  --disconnect-prob 0.1 \
  --log-level INFO

查看帮助：
----------
uv run python tests/test_concurrent_xiaozhi.py --help

测试内容：
----------
✓ 连接建立和握手
✓ 音频流发送（Opus编码）
✓ 语音识别（ASR）
✓ 文本消息发送
✓ 音频响应接收（TTS）
✓ 随机打断测试
✓ 随机断开连接测试
✓ 完整统计数据收集

输出统计：
----------
- 连接/断开次数
- 消息发送/接收总数
- 音频帧数和字节数
- 打断次数
- 错误次数
- 每个客户端的详细统计

更多信息：
----------
- 快速开始指南：tests/QUICKSTART_CONCURRENT_TEST.md
- 完整文档：tests/README_CONCURRENT_TEST.md

================================================================================

